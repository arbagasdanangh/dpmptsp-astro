---
import "../../styles/global.css";

const IMAGE_BASE = "https://dpm-ptsp.surabaya.go.id/fileberita/";
const { slug } = Astro.params;

let post = null;
let error = false;

try {
  const res = await fetch(
    `http://parkir.dpmptsp-surabaya.my.id/api/v1/posts/${slug}`
  );
  const json = await res.json();
  post = json.data ?? null;
} catch (e) {
  console.error(e);
  error = true;
}
---

<html lang="id">
  <head>
    <title>{post?.title ?? "Detail Berita"}</title>
  </head>

  <body>
    {error && <p>Error mengambil data</p>}

    {post && (
      <article>
        <h1>{post.title}</h1>
        <img src={`${IMAGE_BASE}${post.image}`} alt={post.title} />
        <div set:html={post.content}></div>
      </article>
    )}
  </body>
</html>
