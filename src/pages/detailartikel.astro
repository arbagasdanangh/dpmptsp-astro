---
import MainLayout from "../layouts/MainLayout.astro";
import { slugify } from "../utils/slugify";

import { Astro } from 'astro';

// Ambil slug dari URL
const { slug } = Astro.params;

// Panggil API untuk ambil detail berita berdasarkan slug
const res = await fetch(`${import.meta.env.BASE_URL}/api/v1/posts/${slug}`);
const json = await res.json();
const data = json.data;

// Format tanggal
const formattedDate = new Date(data.date).toLocaleDateString('id-ID', {
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<MainLayout title={data.seo_title || data.title}>
  <article class="max-w-5xl mx-auto p-4 md:p-8 bg-white rounded-xl shadow-lg">
    <!-- Judul Berita -->
    <h1 class="text-3xl md:text-4xl font-bold mb-4">{data.title}</h1>

    <!-- Info Tanggal & Kategori -->
    <div class="text-gray-500 mb-6">
      <span>{formattedDate}</span>
      {data.category && (
        <>
          {' | '}
          <span>{data.category.name}</span>
        </>
      )}
    </div>

    <!-- Gambar -->
    {data.picture && (
      <img
        src={`https://dpm-ptsp.surabaya.go.id/fileberita/${data.picture}`}
        alt={data.title}
        class="w-full h-auto rounded-lg mb-6"
      />
    )}

    <!-- Konten Berita -->
    <div class="prose max-w-full" innerHTML={data.ref}></div>
  </article>
</MainLayout>
