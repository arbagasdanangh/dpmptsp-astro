---
export const prerender = false;

import MainLayout from "../../layouts/MainLayout.astro";

const BASE_URL = "http://parkir.dpmptsp-surabaya.my.id";
const { slug } = Astro.params;

let post = null;

try {
  const res = await fetch(`${BASE_URL}/api/v1/posts/${slug}`);

  if (!res.ok) {
    throw new Error("Artikel tidak ditemukan");
  }

  const json = await res.json();
  post = json.data;
} catch (err) {
  console.error("Gagal mengambil artikel:", err);
  throw new Response("Artikel tidak ditemukan", { status: 404 });
}
---
<MainLayout title={post.seo_title ?? post.title}>

<section class="container mx-auto px-4 py-12 max-w-4xl">

  <!-- Judul -->
  <h1 class="text-3xl md:text-4xl font-bold text-blue-800 mb-4">
    {post.title}
  </h1>

  <!-- Meta -->
  <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 mb-6">
    <span>{post.date}</span>
    <span>â€¢</span>
    <span class="capitalize">
      {post.category?.name ?? "Umum"}
    </span>
  </div>

  <!-- Gambar -->
  <img
    src={
      post.picture
        ? `https://dpm-ptsp.surabaya.go.id/fileberita/${post.picture}`
        : "/img/default-berita.jpg"
    }
    alt={post.title}
    loading="lazy"
    class="w-full rounded-xl mb-8 shadow"
  />

  <!-- Isi -->
  <article
    class="prose prose-lg max-w-none text-justify"
    set:html={post.ref}
  />

  <!-- Tags / Kategori -->
  <div class="mt-10 pt-6 border-t">
    <span class="font-semibold text-gray-700 mr-2">Kategori:</span>
    <span class="inline-block bg-gray-100 px-3 py-1 rounded-full text-sm">
      #{post.category?.slug}
    </span>
  </div>

</section>

</MainLayout>
