---
// pages/posts/[slug].astro
import MainLayout from '../../layouts/MainLayout.astro';

const { slug } = Astro.params; // Ambil slug dari URL
const API_URL = `http://parkir.dpmptsp-surabaya.my.id/api/v1/posts/${slug}`;

let post = null;
let error = null;

try {
  const res = await fetch(API_URL);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  post = await res.json();
} catch (e) {
  error = e.message;
}
---

<MainLayout>
  {error && <p class="text-red-500">Error: {error}</p>}

  {post && (
    <article class="prose mx-auto my-8">
      <h1>{post.title}</h1>
      <p class="text-gray-500">{post.date}</p>
      {post.image && (
        <img
          src={`https://dpm-ptsp.surabaya.go.id/fileberita/${post.image}`}
          alt={post.title}
          class="rounded-lg my-4"
        />
      )}
      <div innerHTML={post.content}></div>
    </article>
  )}
</MainLayout>
