---
export const prerender = false;

import MainLayout from "../../layouts/MainLayout.astro";

// ======================
// KONFIGURASI API
// ======================
const BASE_URL = "http://parkir.dpmptsp-surabaya.my.id";

// ======================
// AMBIL SLUG DARI URL
// ======================
const slug = Astro.params.slug;

// ======================
// FETCH DETAIL ARTIKEL
// ======================
let post = null;

try {
  const res = await fetch(`${BASE_URL}/api/v1/posts/${slug}`);

  if (!res.ok) {
    throw new Error("Artikel tidak ditemukan");
  }

  const json = await res.json();
  post = json.data;
} catch (err) {
  console.error("Gagal ambil artikel:", err);
}
---

<MainLayout title={post?.title ?? "Artikel Tidak Ditemukan"}>

  {!post && (
    <section class="container mx-auto px-4 py-20 text-center">
      <h1 class="text-2xl font-bold text-gray-700">
        Artikel tidak ditemukan
      </h1>
    </section>
  )}

  {post && (
    <>
      <!-- HERO -->
      <section class="bg-gradient-to-r from-blue-800 to-blue-900 py-14 text-white text-center">
        <h1 class="text-3xl md:text-4xl font-bold max-w-4xl mx-auto">
          {post.title}
        </h1>
        <p class="mt-3 text-sm opacity-90">
          {post.category?.name} â€¢ {post.date}
        </p>
      </section>

      <!-- CONTENT -->
      <section class="container mx-auto px-4 py-12">
        <article class="max-w-4xl mx-auto bg-white rounded-2xl shadow p-6 md:p-10">

          {post.picture && (
            <img
              src={`https://dpm-ptsp.surabaya.go.id/fileberita/${post.picture}`}
              alt={post.title}
              class="w-full h-[420px] object-cover rounded-xl mb-8"
            />
          )}

          <!-- ISI ARTIKEL -->
          <div
            class="prose prose-lg max-w-none text-justify"
            set:html={post.ref}
          />

          <!-- TAG -->
          <div class="mt-10 pt-6 border-t">
            <span class="text-sm font-semibold text-gray-600">
              Tag:
            </span>
            <span class="ml-2 inline-block bg-gray-100 px-3 py-1 rounded-full text-sm">
              #{post.category?.slug}
            </span>
          </div>

        </article>
      </section>
    </>
  )}

</MainLayout>
