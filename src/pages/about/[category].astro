---
import MainLayout from "../../layouts/MainLayout.astro";

const BASE_URL = "https://parkir.dpmptsp-surabaya.my.id";

/* ================= PARAM ================= */
const { category } = Astro.params;

/* ================= FETCH DETAIL ================= */
const res = await fetch(`${BASE_URL}/api/v1/about-me/ikm/${category}`);

if (!res.ok) {
  throw new Error("Data tidak ditemukan");
}

const json = await res.json();

/*
Response:
{
  status: "success",
  data: {
    category: "ikm",
    data: [ {...} ]
  }
}
*/
const items = json?.data?.data || [];
const detail = items[0]; // karena biasanya 1 data
---

<MainLayout title={detail?.title ?? "Detail Informasi"}>
  <main class="min-h-screen bg-gray-50">

    <!-- HEADER -->
    <section class="bg-blue-800 text-white py-16">
      <div class="container mx-auto px-4 text-center">
        <h1 class="text-4xl font-bold mb-4">
          {detail?.title}
        </h1>
        <p class="text-blue-100 max-w-2xl mx-auto">
          {detail?.description || "Informasi resmi organisasi"}
        </p>
      </div>
    </section>

    <!-- CONTENT -->
    <section class="container mx-auto px-4 py-16">
      <div class="bg-white rounded-2xl shadow-xl p-6 md:p-10 max-w-5xl mx-auto">

        <!-- IMAGE -->
        {detail?.file && (
          <div class="mb-8">
            <img
              src={`${BASE_URL}/storage/${detail.file}`}
              alt={detail.title}
              class="w-full rounded-xl shadow-md"
              loading="lazy"
            />
          </div>
        )}

        <!-- META -->
        <div class="flex flex-wrap gap-6 text-sm text-gray-500 mb-8">
          <span>ðŸ“‚ Kategori: {detail?.category}</span>
          <span>
            ðŸ—“ Tanggal:
            {new Date(detail?.created_at).toLocaleDateString("id-ID")}
          </span>
        </div>

        <!-- CONTENT TEXT -->
        <article class="prose max-w-none prose-blue">
          {detail?.content ? (
            <div set:html={detail.content} />
          ) : (
            <p>
              Dokumen <strong>{detail?.name}</strong> ini merupakan bagian dari
              informasi resmi organisasi DPMPTSP Kota Surabaya.
            </p>
          )}
        </article>

      </div>
    </section>

  </main>
</MainLayout>
