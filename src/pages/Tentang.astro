---
import MainLayout from "../../layouts/MainLayout.astro";
import { db } from "../../lib/db";

const { slug } = Astro.params;

// ======================
// NAVBAR (URUTAN FIX)
// ======================
const menus = [
  { slug: "sambutan", label: "Sambutan", icon: "üéôÔ∏è" },
  { slug: "visi-misi", label: "Visi dan Misi", icon: "üéØ" },
  { slug: "budaya-pelayanan", label: "Budaya Pelayanan", icon: "ü§ù" },
  { slug: "motto-pelayanan", label: "Motto Pelayanan", icon: "üí¨" },
  { slug: "maklumat-pelayanan", label: "Maklumat Pelayanan", icon: "üìÑ" },
  { slug: "kompensasi-layanan", label: "Kompensasi Layanan", icon: "üí∞" },
  { slug: "ikm", label: "Indeks Kepuasan Masyarakat", icon: "üìä" },
  { slug: "zona-integritas", label: "Zona Integritas", icon: "üõ°Ô∏è" },
];

// ======================
// DATA
// ======================
let data = [];
try {
  const [rows] = await db.execute(
    "SELECT title, content, file FROM informasi WHERE slug = ? ORDER BY id DESC",
    [slug]
  );
  data = rows;
} catch (e) {
  console.error(e);
}

const currentMenu = menus.find(m => m.slug === slug);
const isSambutan = slug === "sambutan";
---

<MainLayout title={currentMenu?.label || "Informasi"}>
<section class="bg-gray-50 py-16">
  <div class="container mx-auto px-6 grid lg:grid-cols-[280px_1fr] gap-10">

    <!-- ================= SIDEBAR ================= -->
    <aside class="bg-white rounded-2xl shadow p-6">
      <h3 class="text-blue-700 font-bold mb-6 flex items-center gap-2">
        ‚ò∞ Menu Informasi
      </h3>

      <ul class="space-y-2">
        {menus.map(menu => (
          <li>
            <a
              href={`/informasi/${menu.slug}`}
              class={`flex items-center gap-3 px-4 py-3 rounded-xl transition
                ${menu.slug === slug
                  ? "bg-blue-600 text-white font-semibold"
                  : "hover:bg-gray-100 text-gray-700"}`}
            >
              <span>{menu.icon}</span>
              {menu.label}
            </a>
          </li>
        ))}
      </ul>
    </aside>

    <!-- ================= CONTENT ================= -->
    <main class="bg-white rounded-2xl shadow p-10">

      <header class="flex items-center gap-4 mb-8">
        <div class="w-12 h-12 flex items-center justify-center rounded-full bg-blue-600 text-white text-xl">
          {currentMenu?.icon}
        </div>
        <div>
          <h1 class="text-3xl font-bold text-blue-800">
            {currentMenu?.label}
          </h1>
          {isSambutan && (
            <p class="text-gray-500 text-sm">
              Kepala Dinas DPM-PTSP Kota Surabaya
            </p>
          )}
        </div>
      </header>

      {data.length === 0 && (
        <div class="text-gray-500 italic">
          Informasi sedang dipersiapkan.
        </div>
      )}

      {data.map(item => (
        <article class="mb-14 last:mb-0">

          <!-- ================= GAMBAR ================= -->
          {!isSambutan && item.file && (
            <img
              src={`https://dpm-ptsp.surabaya.go.id/storage/${item.file}`}
              alt={item.title}
              class="rounded-2xl shadow max-w-md mx-auto mb-8"
            />
          )}

          <!-- ================= KONTEN ================= -->
          {isSambutan ? (
            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-xl p-8 italic text-gray-700 leading-relaxed">
              ‚Äú{item.content}‚Äù
              <div class="mt-6 text-right font-semibold text-blue-700 not-italic">
                Kepala Dinas DPM-PTSP  
                <div class="text-sm font-normal text-gray-600">
                  Kota Surabaya
                </div>
              </div>
            </div>
          ) : (
            <div class="prose max-w-none text-gray-700">
              {item.content}
            </div>
          )}

        </article>
      ))}

    </main>
  </div>
</section>
</MainLayout>
