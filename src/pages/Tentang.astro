---
import MainLayout from "../layouts/MainLayout.astro";

const API_BASE =
  import.meta.env.PUBLIC_API_BASE ||
  "https://parkir.dpmptsp-surabaya.my.id";

const FILE_BASE =
  import.meta.env.PUBLIC_FILE_BASE ||
  "https://dpm-ptsp.surabaya.go.id/fileberita";

/* ================= ABOUT ================= */
let about = {};
try {
  const res = await fetch(`${API_BASE}/api/v1/about-me`);
  const json = await res.json();
  about = json?.data || {};
} catch {}

/* ================= IKM (FIX ENDPOINT) ================= */
let ikmData = [];

try {
  const res = await fetch(`${API_BASE}/api/v1/about-me/ikm`);
  const json = await res.json();

  // fleksibel: array atau single object
  if (Array.isArray(json?.data)) {
    ikmData = json.data;
  } else if (json?.data) {
    ikmData = [json.data];
  }
} catch {}
---

<MainLayout title="Tentang Kami - DPMPTSP Kota Surabaya">

  <!-- HERO -->
  <section class="bg-gradient-to-b from-blue-50 to-white py-20">
    <div class="text-center max-w-3xl mx-auto">
      <h1 class="text-4xl font-extrabold text-blue-800 mb-4">
        Profil & Kualitas Pelayanan
      </h1>
      <p class="text-gray-600 text-lg">
        Informasi resmi tentang organisasi dan Indeks Kepuasan Masyarakat
      </p>
    </div>
  </section>

  <section class="container mx-auto px-4 pb-24">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-10">

      <!-- SIDEBAR -->
      <aside class="sticky top-24">
        <div class="bg-white rounded-2xl shadow p-6">
          <h3 class="text-blue-700 font-bold mb-5">Menu Informasi</h3>
          <ul class="space-y-1 text-sm">
            {[
              "Sambutan",
              "Visi dan Misi",
              "Indeks Kepuasan Masyarakat",
              "Struktur Organisasi",
            ].map((item, i) => (
              <li
                class={`px-4 py-2 rounded-lg ${
                  i === 2
                    ? "bg-blue-600 text-white font-semibold"
                    : "text-gray-600 hover:bg-blue-50"
                }`}
              >
                {item}
              </li>
            ))}
          </ul>
        </div>
      </aside>

      <!-- MAIN -->
      <div class="lg:col-span-3 space-y-14">

        <!-- SAMBUTAN -->
        <section class="bg-white rounded-2xl shadow p-10">
          <h2 class="text-2xl font-bold text-blue-700 mb-6">
            Sambutan Kepala Dinas
          </h2>
          <blockquote class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-lg italic text-gray-700">
            {about.sambutan || "-"}
          </blockquote>
        </section>

        <!-- IKM -->
        <section class="bg-white rounded-2xl shadow p-10">
          <h2 class="text-2xl font-bold text-blue-700 mb-8">
            Indeks Kepuasan Masyarakat (IKM)
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            {ikmData.map((item) => (
              <div class="rounded-xl border overflow-hidden hover:shadow-xl transition">
                {item.file && (
                  <img
                    src={`${FILE_BASE}/${item.file}`}
                    alt={item.title || "IKM"}
                    class="w-full h-56 object-cover"
                  />
                )}
                <div class="p-4 text-center">
                  <h3 class="font-semibold text-gray-700">
                    {item.title || "Indeks Kepuasan Masyarakat"}
                  </h3>
                  {item.description && (
                    <p class="text-sm text-gray-500 mt-2">
                      {item.description}
                    </p>
                  )}
                </div>
              </div>
            ))}
          </div>

          {ikmData.length === 0 && (
            <p class="text-gray-500 italic">
              Data IKM belum tersedia.
            </p>
          )}
        </section>

      </div>
    </div>
  </section>
</MainLayout>
