---
import MainLayout from "../layouts/MainLayout.astro";

const API_BASE = import.meta.env.PUBLIC_API_BASE;
const FILE_BASE = import.meta.env.PUBLIC_FILE_BASE;

// query menu
const active = Astro.url.searchParams.get("menu") || "sambutan";

// fetch menu utama
const aboutRes = await fetch(`${API_BASE}/api/v1/about-me`);
const aboutJson = await aboutRes.json();
const about = aboutJson?.data || {};

// fetch detail jika bukan sambutan
let detailData = [];
if (active !== "sambutan") {
  const detailRes = await fetch(
    `${API_BASE}/api/v1/about-me/detail?category=${active}`
  );
  const detailJson = await detailRes.json();
  detailData = detailJson?.data?.data || [];
}
---

<MainLayout title="Tentang Kami | DPMPTSP Kota Surabaya">
<section class="bg-gray-50 py-16">
  <div class="container mx-auto px-4">

    <!-- HEADER -->
    <div class="text-center mb-14">
      <h1 class="text-4xl font-bold text-blue-700 mb-3">
        Visi Misi Sambutan Tim Organisasi
      </h1>
      <p class="text-gray-600">
        Informasi lengkap tentang organisasi, visi misi, dan pelayanan DPM-PTSP Kota Surabaya
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

      <!-- SIDEBAR -->
      <aside class="bg-white rounded-xl shadow p-5">
        <h3 class="font-bold text-blue-600 mb-4">Menu Informasi</h3>
        <ul class="space-y-2 text-sm">

          {[
            ["sambutan", "Sambutan"],
            ["visi-misi", "Visi dan Misi"],
            ["budaya", "Budaya Pelayanan"],
            ["motto", "Motto Pelayanan"],
            ["maklumat", "Maklumat Pelayanan"],
            ["ikm", "Indeks Kepuasan Masyarakat"],
            ["zona-integritas", "Zona Integritas"],
            ["struktur", "Struktur Organisasi"],
          ].map(([key, label]) => (
            <li>
              <a
                href={`/Tentang?menu=${key}`}
                class={`block px-4 py-2 rounded-lg ${
                  active === key
                    ? "bg-blue-600 text-white"
                    : "hover:bg-gray-100"
                }`}
              >
                {label}
              </a>
            </li>
          ))}
        </ul>
      </aside>

      <!-- CONTENT -->
      <main class="lg:col-span-3">

        <!-- SAMBUTAN -->
        {active === "sambutan" && (
          <div class="bg-white rounded-xl shadow p-8">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">
              Sambutan
            </h2>

            <blockquote class="bg-yellow-50 border-l-4 border-yellow-400 p-6 italic text-gray-700 leading-relaxed">
              {about.sambutan}
            </blockquote>

            <div class="text-right mt-6 font-semibold text-blue-700">
              Kepala Dinas DPM-PTSP<br />
              <span class="text-gray-500 text-sm">Kota Surabaya</span>
            </div>
          </div>
        )}

        <!-- DETAIL (IKM, dll) -->
        {active !== "sambutan" && (
          <div class="bg-white rounded-xl shadow p-8">
            <h2 class="text-2xl font-bold text-blue-700 mb-6 capitalize">
              {active.replace("-", " ")}
            </h2>

            {detailData.length === 0 && (
              <p class="text-gray-500">Data belum tersedia.</p>
            )}

            <!-- GRID IMAGE -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
              {detailData.map(item => (
                <div class="border rounded-lg overflow-hidden hover:shadow-lg transition">
                  <img
                    src={`${FILE_BASE}/${item.file}`}
                    alt={item.title}
                    class="w-full h-56 object-cover"
                    loading="lazy"
                  />
                  <div class="p-4">
                    <h3 class="font-semibold text-sm text-gray-800">
                      {item.title}
                    </h3>
                    {item.description && (
                      <p class="text-xs text-gray-500 mt-1">
                        {item.description}
                      </p>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

      </main>
    </div>
  </div>
</section>
</MainLayout>
