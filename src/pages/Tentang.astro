---
import MainLayout from "../layouts/MainLayout.astro";

const BASE_URL = "https://parkir.dpmptsp-surabaya.my.id";

/* ===== MENU FIXED ORDER (PERSIS GAMBAR) ===== */
const menus = [
  { title: "Sambutan", category: "sambutan", icon: "ğŸ™ï¸" },
  { title: "Visi dan Misi", category: "visi-misi", icon: "ğŸ¯" },
  { title: "Budaya Pelayanan", category: "budaya", icon: "ğŸ¤" },
  { title: "Motto Pelayanan", category: "motto-layanan", icon: "ğŸ’¬" },
  { title: "Maklumat Pelayanan", category: "maklumat", icon: "ğŸ“œ" },
  { title: "Kompensasi Layanan", category: "kompensasi", icon: "ğŸ’°" },
  { title: "Indeks Kepuasan Masyarakat", category: "ikm", icon: "ğŸ˜Š" },
  { title: "Zona Integritas", category: "zona-integritas", icon: "ğŸ›¡ï¸" },
];
---

<MainLayout title="Tentang DPMPTSP Surabaya">
<section class="py-16 bg-[#f6f8fc]">
  <div class="container mx-auto px-6 grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-8">

    <!-- SIDEBAR -->
    <aside class="bg-white rounded-2xl shadow p-5">
      <div class="flex items-center gap-2 mb-4 text-blue-600 font-semibold">
        â˜° Menu Informasi
      </div>

      <div class="space-y-2">
        {menus.map((m, i) => (
          <button
            class={`tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition
            ${i === 0
              ? "bg-blue-600 text-white"
              : "bg-gray-100 hover:bg-blue-50 text-gray-700"}`}
            data-category={m.category}
          >
            <span>{m.icon}</span>
            <span>{m.title}</span>
          </button>
        ))}
      </div>
    </aside>

    <!-- CONTENT -->
    <main class="bg-white rounded-2xl shadow p-10 min-h-[420px]">
      <div id="content-area"></div>
    </main>

  </div>
</section>
</MainLayout>

<!-- ================= CLIENT SCRIPT ================= -->
<script>
const BASE_URL = "https://parkir.dpmptsp-surabaya.my.id";
const tabs = document.querySelectorAll(".tab-btn");
const content = document.getElementById("content-area");

async function loadCategory(category) {
  const res = await fetch(`${BASE_URL}/api/v1/about-me/${category}`);
  const json = await res.json();
  const data = json?.data?.data || [];

  if (category === "sambutan") {
    const item = data[0] || {};
    content.innerHTML = `
      <div class="flex items-center gap-3 mb-6">
        <div class="bg-blue-600 text-white w-10 h-10 rounded-full flex items-center justify-center">
          ğŸ™ï¸
        </div>
        <div>
          <h2 class="text-2xl font-bold text-blue-700">Sambutan</h2>
          <p class="text-sm text-gray-500">
            Kepala Dinas DPM-PTSP Kota Surabaya
          </p>
        </div>
      </div>

      <div class="relative bg-yellow-50 border-l-4 border-blue-600 rounded-xl p-8">
        <div class="absolute top-4 left-4 text-4xl text-yellow-400">â€œ</div>

        <p class="text-gray-700 leading-relaxed italic">
          ${
            item.content && item.content.trim() !== ""
              ? item.content
              : "Assalamuâ€™alaikum Warahmatullahi Wabarakatuh. Puji syukur kami panjatkan kehadirat Allah SWT, dengan rahmat-Nya Dinas DPM-PTSP Kota Surabaya terus berupaya meningkatkan kualitas pelayanan investasi dan perizinan kepada masyarakat."
          }
        </p>
      </div>

      <div class="text-right mt-8">
        <p class="font-semibold text-blue-700">
          Kepala Dinas DPM-PTSP
        </p>
        <p class="text-sm text-gray-500">
          Kota Surabaya
        </p>
      </div>
    `;
    return;
  }

  // ===== KATEGORI LAIN =====
  if (!data.length) {
    content.innerHTML = `<p class="text-gray-500">Informasi sedang dipersiapkan.</p>`;
    return;
  }

  content.innerHTML = data.map(item => `
    <h2 class="text-2xl font-bold text-blue-700 mb-6">
      ${item.title}
    </h2>

    ${
      item.file
        ? `<img src="${BASE_URL}/storage/${item.file}"
             class="rounded-xl shadow max-w-md mb-6" />`
        : ""
    }

    <div class="prose max-w-none text-gray-700">
      ${item.content || "Informasi sedang dipersiapkan."}
    </div>
  `).join("");
}

// TAB EVENT
tabs.forEach((btn, i) => {
  btn.addEventListener("click", () => {
    tabs.forEach(b => b.classList.remove("bg-blue-600", "text-white"));
    btn.classList.add("bg-blue-600", "text-white");
    loadCategory(btn.dataset.category);
  });

  if (i === 0) loadCategory(btn.dataset.category);
});
</script>
