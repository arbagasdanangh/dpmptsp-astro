---
import MainLayout from "../../layouts/MainLayout.astro";

/* ================= CONFIG ================= */
const BASE_URL = import.meta.env.PUBLIC_BASE_URL;

/* ================= FETCH API ================= */
const [ikmRes, categoryRes] = await Promise.all([
  fetch(`${BASE_URL}/api/v1/about-me/ikm`),
  fetch(`${BASE_URL}/api/v1/about-me`)
]);

const ikmData = await ikmRes.json();        // API 1
const categoryData = await categoryRes.json(); // API 2

// API 1 biasanya array
const ikm = Array.isArray(ikmData) ? ikmData[0] : ikmData;

// Ambil judul kategori dari API 2
const categoryTitle =
  categoryData?.data?.ikm ?? "Indeks Kepuasan Masyarakat";
---

<MainLayout title={categoryTitle}>
  <main class="min-h-screen bg-gray-50">
    <section class="container mx-auto px-4 py-16">

      <!-- HEADER -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-blue-800 mb-4">
          {ikm?.title || categoryTitle}
        </h1>
        <p class="text-gray-600 max-w-2xl mx-auto">
          {ikm?.description || "Informasi Indeks Kepuasan Masyarakat"}
        </p>
      </div>

      <!-- CONTENT -->
      <div class="bg-white rounded-2xl shadow p-6 max-w-4xl mx-auto">

        <!-- IMAGE -->
        {ikm?.file && (
          <div class="mb-6">
            <img
              src={`${BASE_URL}/storage/${ikm.file}`}
              alt={ikm.title}
              class="w-full rounded-xl shadow"
              loading="lazy"
            />
          </div>
        )}

        <!-- META -->
        <div class="text-sm text-gray-500 mb-4 flex flex-wrap gap-4">
          <span>ðŸ“‚ Kategori: {ikm?.category}</span>
          <span>
            ðŸ—“ Dibuat:
            {new Date(ikm?.created_at).toLocaleDateString("id-ID")}
          </span>
        </div>

        <!-- CONTENT TEXT -->
        <article class="prose max-w-none">
          {ikm?.content
            ? <div set:html={ikm.content} />
            : <p>Dokumen Indeks Kepuasan Masyarakat Organisasi.</p>
          }
        </article>
      </div>

    </section>
  </main>
</MainLayout>
