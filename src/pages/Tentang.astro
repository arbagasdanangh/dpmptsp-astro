---
import MainLayout from "../layouts/MainLayout.astro";

const BASE_URL = "https://parkir.dpmptsp-surabaya.my.id";

/* ===== MENU ===== */
const menuOrder = [
  { key: "sambutan", label: "Sambutan", icon: "fa-microphone" },
  { key: "visi-misi", label: "Visi dan Misi", icon: "fa-bullseye" },
  { key: "struktur", label: "Struktur Organisasi", icon: "fa-sitemap" },
  { key: "piagam", label: "Piagam Pelayanan", icon: "fa-certificate" },
  { key: "budaya", label: "Budaya Pelayanan", icon: "fa-hands-helping" },
  { key: "motto-layanan", label: "Motto Pelayanan", icon: "fa-quote-right" },
  { key: "maklumat", label: "Maklumat Pelayanan", icon: "fa-scroll" },
  { key: "kompensasi", label: "Kompensasi Layanan", icon: "fa-hand-holding-usd" },
  { key: "ikm", label: "Indeks Kepuasan Masyarakat", icon: "fa-smile" },
  { key: "zona-integritas", label: "Zona Integritas", icon: "fa-shield-alt" },
];

/* ===== DEFAULT LOAD ===== */
const res = await fetch(`${BASE_URL}/api/v1/about-me/sambutan`);
const json = await res.json();
const contents = json?.data?.data || [];
---

<MainLayout title="Informasi Organisasi">
<section class="py-20 bg-gray-50">
  <div class="container mx-auto px-4 grid grid-cols-1 lg:grid-cols-4 gap-8">

    <!-- SIDEBAR -->
    <aside class="bg-white rounded-2xl shadow p-6">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center">
          <i class="fas fa-bars"></i>
        </div>
        <h3 class="font-bold text-blue-700">Menu Informasi</h3>
      </div>

      <div class="space-y-2">
        {menuOrder.map((m, i) => (
          <button
            class={`menu-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition
            ${i === 0 ? "bg-blue-600 text-white" : "bg-gray-100 hover:bg-blue-50 text-gray-700"}`}
            data-category={m.key}
          >
            <i class={`fas ${m.icon}`}></i>
            {m.label}
          </button>
        ))}
      </div>
    </aside>

    <!-- CONTENT -->
    <div class="lg:col-span-3">
      <div id="content-area" class="bg-white rounded-2xl shadow p-10 space-y-10">

        {contents.map((item) => (
          item.category === "sambutan" ? (
            <!-- SAMBUTAN -->
            <div>
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center">
                  <i class="fas fa-microphone"></i>
                </div>
                <h2 class="text-3xl font-bold text-blue-700">Sambutan</h2>
              </div>

              <p class="text-gray-500 mb-6">
                Kepala Dinas DPM-PTSP Kota Surabaya
              </p>

              <div class="bg-blue-50 border-l-4 border-blue-600 rounded-xl p-6 italic leading-relaxed text-gray-700">
                {item.content}
              </div>

              <div class="text-right mt-6">
                <p class="font-semibold text-blue-700">Kepala Dinas DPM-PTSP</p>
                <p class="text-sm text-gray-500">Kota Surabaya</p>
              </div>
            </div>
          ) : (
            <!-- SEMUA NON SAMBUTAN (TERMASUK IKM) -->
            <div class={item.category === "ikm" ? "text-center" : ""}>
              <h2 class="text-2xl font-bold text-blue-700 mb-6">
                {item.title}
              </h2>

              {item.file ? (
                <img
                  src={`https://dpm-ptsp.surabaya.go.id/tentangfile/${item.file}`}
                  alt={item.title}
                  class={`rounded-xl shadow mx-auto ${
                    item.category === "ikm" ? "max-w-md" : "max-w-full"
                  }`}
                />
              ) : (
                <p class="text-gray-500">File tidak tersedia.</p>
              )}
            </div>
          )
        ))}

      </div>
    </div>
  </div>
</section>
</MainLayout>

<script>
const buttons = document.querySelectorAll(".menu-btn");
const contentArea = document.getElementById("content-area");
const BASE_URL = "https://parkir.dpmptsp-surabaya.my.id";

buttons.forEach(btn => {
  btn.addEventListener("click", async () => {
    buttons.forEach(b => b.classList.remove("bg-blue-600","text-white"));
    btn.classList.add("bg-blue-600","text-white");

    const category = btn.dataset.category;
    contentArea.innerHTML = '<p class="text-center text-gray-500">Memuat...</p>';

    const res = await fetch(`${BASE_URL}/api/v1/about-me/${category}`);
    const json = await res.json();
    const data = json?.data?.data || [];

    if (!data.length) {
      contentArea.innerHTML = '<p class="text-center text-gray-500">Data tidak tersedia.</p>';
      return;
    }

    contentArea.innerHTML = data.map(item => {
      if (item.category === "sambutan") {
        return `
          <div class="italic bg-blue-50 p-6 rounded-xl border-l-4 border-blue-600">
            ${item.content}
          </div>
        `;
      }

      return `
        <div class="${item.category === "ikm" ? "text-center" : ""}">
          <h2 class="text-2xl font-bold text-blue-700 mb-6">${item.title}</h2>
          ${
            item.file
              ? `<img src="https://dpm-ptsp.surabaya.go.id/tentangfile/${item.file}" class="rounded-xl shadow mx-auto ${item.category === "ikm" ? "max-w-md" : "max-w-full"}" />`
              : `<p class="text-gray-500">File tidak tersedia.</p>`
          }
        </div>
      `;
    }).join("");
  });
});
</script>
